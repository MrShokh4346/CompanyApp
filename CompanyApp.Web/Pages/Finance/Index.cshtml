@page
@model CompanyApp.Web.Pages.Finance.IndexModel
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<h3 class="mb-3">Финансы</h3>

<ul class="nav nav-pills mb-3">
  <li class="nav-item">
    <a class="nav-link @(Model.View=="income"?"active":"")" href="/Finance?view=income">Доходы</a>
  </li>
  <li class="nav-item">
    <a class="nav-link @(Model.View=="expenses"?"active":"")" href="/Finance?view=expenses">Расходы</a>
  </li>
  <li class="nav-item">
    <a class="nav-link @(Model.View=="debtors"?"active":"")" href="/Finance?view=debtors">Дебиторы</a>
  </li>
  <li class="nav-item">
    <a class="nav-link @(Model.View=="creditors"?"active":"")" href="/Finance?view=creditors">Кредиторы</a>
  </li>
</ul>

@if (Model.View == "income")
{
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="fw-semibold mb-2">Доходы (заказы)</div>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Дата</th>
              <th>Клиент</th>
              <th>Накладная №</th>
              <th class="text-end">Сумма</th>
              <th class="text-end">Оплачено</th>
              <th class="text-end">К оплате</th>
            </tr>
          </thead>
          <tbody>
          @foreach (var r in Model.Income)
          {
            <tr>
              <td>@r.Date.ToLocalTime().ToString("dd.MM.yyyy")</td>
              <td>@r.Customer</td>
              <td>
                @if (!string.IsNullOrWhiteSpace(r.InvoiceNumber))
                {
                  <a href="/Orders/Invoice?id=@r.Id&generate=true" target="_blank" rel="noopener">@r.InvoiceNumber</a>
                }
                else
                {
                  <a href="/Orders/Invoice?id=@r.Id&generate=true" target="_blank" rel="noopener">Открыть</a>
                }
              </td>
              <td class="text-end">@r.Total.ToString("C")</td>
              <td class="text-end">@r.Paid.ToString("C")</td>
              <td class="text-end @(r.Due>0?"text-danger fw-semibold":"")">@r.Due.ToString("C")</td>
            </tr>
          }
          </tbody>
          <tfoot>
            <tr class="fw-bold">
              <td colspan="3" class="text-end">Итого:</td>
              <td class="text-end">@Model.IncomeTotal.ToString("C")</td>
              <td class="text-end">@Model.IncomePaid.ToString("C")</td>
              <td class="text-end">@Model.IncomeDue.ToString("C")</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
}
else if (Model.View == "expenses")
{
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="fw-semibold mb-2">Расходы (приходные накладные)</div>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Дата</th>
              <th>Поставщик</th>
              <th>Накладная №</th>
              <th class="text-end">Сумма</th>
              <th class="text-end">Оплачено</th>
              <th class="text-end">Долг</th>
            </tr>
          </thead>
          <tbody>
          @foreach (var r in Model.Expenses)
          {
            <tr>
              <td>@r.Date.ToLocalTime().ToString("dd.MM.yyyy")</td>
              <td>@r.Supplier</td>
              <td><a href="/Purchase/Invoices/Edit?id=@r.Id">@r.Number</a></td>
              <td class="text-end">@r.Total.ToString("C")</td>
              <td class="text-end">@r.Paid.ToString("C")</td>
              <td class="text-end @(r.Due>0?"text-danger fw-semibold":"")">@r.Due.ToString("C")</td>
            </tr>
          }
          </tbody>
          <tfoot>
            <tr class="fw-bold">
              <td colspan="3" class="text-end">Итого:</td>
              <td class="text-end">@Model.ExpensesTotal.ToString("C")</td>
              <td class="text-end">@Model.ExpensesPaid.ToString("C")</td>
              <td class="text-end">@Model.ExpensesDue.ToString("C")</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
}
else if (Model.View == "debtors")
{
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="fw-semibold mb-2">Дебиторы (заказы с задолженностью)</div>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Дата</th>
              <th>Клиент</th>
              <th>Накладная №</th>
              <th class="text-end">Сумма</th>
              <th class="text-end">Оплачено</th>
              <th class="text-end">Долг</th>
            </tr>
          </thead>
          <tbody>
          @foreach (var r in Model.Debtors)
          {
            <tr>
              <td>@r.Date.ToLocalTime().ToString("dd.MM.yyyy")</td>
              <td>@r.Customer</td>
              <td>
                @if (!string.IsNullOrWhiteSpace(r.InvoiceNumber))
                {
                  <a href="/Orders/Invoice?id=@r.Id&generate=true" target="_blank" rel="noopener">@r.InvoiceNumber</a>
                }
                else
                {
                  <a href="/Orders/Invoice?id=@r.Id&generate=true" target="_blank" rel="noopener">Открыть</a>
                }
              </td>
              <td class="text-end">@r.Total.ToString("C")</td>
              <td class="text-end">@r.Paid.ToString("C")</td>
              <td class="text-end text-danger fw-semibold">@r.Due.ToString("C")</td>
            </tr>
          }
          </tbody>
          <tfoot>
            <tr class="fw-bold">
              <td colspan="5" class="text-end">Всего задолженность:</td>
              <td class="text-end text-danger">@Model.DebtorsDue.ToString("C")</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
}
else if (Model.View == "creditors")
{
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="fw-semibold mb-2">Кредиторы (приходные накладные с задолженностью)</div>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Дата</th>
              <th>Поставщик</th>
              <th>Накладная №</th>
              <th class="text-end">Сумма</th>
              <th class="text-end">Оплачено</th>
              <th class="text-end">Долг</th>
            </tr>
          </thead>
          <tbody>
          @foreach (var r in Model.Creditors)
          {
            <tr>
              <td>@r.Date.ToLocalTime().ToString("dd.MM.yyyy")</td>
              <td>@r.Supplier</td>
              <td><a href="/Purchase/Invoices/Edit?id=@r.Id">@r.Number</a></td>
              <td class="text-end">@r.Total.ToString("C")</td>
              <td class="text-end">@r.Paid.ToString("C")</td>
              <td class="text-end text-danger fw-semibold">@r.Due.ToString("C")</td>
            </tr>
          }
          </tbody>
          <tfoot>
            <tr class="fw-bold">
              <td colspan="5" class="text-end">Всего задолженность:</td>
              <td class="text-end text-danger">@Model.CreditorsDue.ToString("C")</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
}
