@{
    var isAuth = User?.Identity?.IsAuthenticated ?? false;
}
@functions{
    string Active(string path) =>
        Context.Request.Path.StartsWithSegments(path) ? "active fw-semibold" : "";
}
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CompanyApp</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

</head>
<br>
<br>


<body class="bg-light">

  <!-- Верхний тёмно-синий navbar -->
<nav class="navbar navbar-dark bg-navy fixed-top">
  <div class="container-fluid">
    <div class="row w-100 align-items-center g-0">
      <!-- ЛЕВАЯ КОЛОНКА: бургер или невидимая заглушка -->
      <div class="col-auto">
        @if (isAuth)
        {
            <button id="toggleSidebar" class="btn btn-outline-light me-2" type="button" aria-label="Меню">☰</button>
        }
        else
        {
            <!-- такая же кнопка, но невидимая — сохраняет ширину -->
            <button class="btn btn-outline-light me-2 invisible" type="button" aria-hidden="true" tabindex="-1">☰</button>
        }
      </div>

      <!-- ЦЕНТР: название всегда по центру -->
      <div class="col text-center">
        <a class="navbar-brand m-0" href="/">CompanyApp</a>
      </div>

      <!-- ПРАВАЯ КОЛОНКА: действия -->
     
    </div>
  </div>
</nav>


  @* Левый сайдбар и подложка рендерим только для авторизованных *@
  @if (isAuth)
  {
    <aside id="sidebar" class="sidebar p-3">
      <nav class="nav flex-column gap-1">
        <a class="nav-link @(Active("/"))" href="/">Главная</a>
        <a class="nav-link @(Active("/Products"))" href="/Products">Товары</a>
        <a class="nav-link @(Active("/Orders"))" href="/Orders">Заказы</a>
        <a class="nav-link @(Active("/Finance"))" href="/Finance">Финансы</a>
        <li class="nav-item"><a class="nav-link" href="/Warehouse/Stock">Остатки</a></li>
        <li class="nav-item"><a class="nav-link" href="/Purchase/Invoices">Приходные накладные</a></li>

        <hr class="my-3"/>
        <div class="small text-muted mb-2">Вы вошли как @(User?.Identity?.Name ?? "Гость")</div>
        <a class="btn btn-sm btn-outline-danger" href="/Account/Logout">Выйти</a>
      </nav>
    </aside>

    <div id="backdrop" class="backdrop"></div>
  }

  <!-- Контент -->
  <main class="content container-fluid p-4">
    @RenderBody()
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Инициализируем сайдбар только если он есть (т.е. пользователь авторизован)
    const toggleBtn = document.getElementById('toggleSidebar');
    const backdrop = document.getElementById('backdrop');

    if (toggleBtn) {
      const body = document.body;

      toggleBtn.addEventListener('click', () => {
        body.classList.toggle('sidebar-open');
      });

      if (backdrop) {
        backdrop.addEventListener('click', () => body.classList.remove('sidebar-open'));
      }

      // По умолчанию: на десктопе открыт, на мобиле закрыт
      function applyInitial() {
        if (window.innerWidth >= 768) body.classList.add('sidebar-open');
        else body.classList.remove('sidebar-open');
      }
      applyInitial();
      window.addEventListener('resize', applyInitial);
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/pwa/service-worker.js');
    }
  </script>
</body>
</html>
