@page
@model CompanyApp.Web.Pages.Orders.InvoiceModel
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
    var o = Model.Order!;
}
@if (TempData["Ok"] is string ok && !string.IsNullOrEmpty(ok))
{
  <div class="alert alert-success">@ok</div>
}

<div class="d-print-none mb-3 btn-toolbar gap-2">
  <a class="btn btn-secondary" href="/Orders/Edit?id=@o.Id">← Назад к заказу</a>
  <a class="btn btn-primary" href="/Orders/Invoice?id=@o.Id&generate=true" target="_blank" rel="noopener">Открыть накладную</a>
  <a class="btn btn-warning" href="/Orders/Invoice?id=@o.Id&generate=true&post=issue">Списать со склада</a>
  <a class="btn btn-outline-primary" href="/orders/@o.Id/invoice.pdf">Скачать PDF</a>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h4 class="mb-1">Накладная</h4>
        <div class="text-muted">
          № @(o.InvoiceNumber ?? "—")<br/>
          Дата: @(o.InvoiceDate?.ToLocalTime().ToString("dd.MM.yyyy HH:mm") ?? "-")
        </div>
      </div>
      <div class="text-end">
        <div class="fw-semibold">CompanyApp</div>
        <div class="text-muted small">Адрес компании<br/>Тел: +998 (00) 000-00-00</div>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <div class="fw-semibold">Покупатель</div>
        <div>@(o.Customer?.FullName ?? "—")</div>
        <div class="text-muted small">
          Email: @(o.Customer?.Email ?? "—")<br/>
          Тел: @(o.Customer?.Phone ?? "—")
        </div>
      </div>
      <div class="col-md-6 text-md-end">
        <div class="fw-semibold">Детали заказа</div>
        <div class="text-muted small">Заказ № @o.Id от @o.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</div>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-sm">
        <thead>
          <tr>
            <th>#</th>
            <th>Товар</th>
            <th class="text-end">Цена</th>
            <th class="text-end">Кол-во</th>
            <th class="text-end">Сумма</th>
          </tr>
        </thead>
        <tbody>
        @{
            var i = 1;
            foreach (var it in o.Items)
            {
                <tr>
                  <td>@i</td>
                  <td>@it.Product.Name</td>
                  <td class="text-end">@it.UnitPrice</td>
                  <td class="text-end">@it.Quantity</td>
                  <td class="text-end">@(it.Quantity * it.UnitPrice)</td>
                </tr>;
                i++;
            }
        }
        </tbody>
      </table>
    </div>

    <!-- Итоги по оплатам -->
    <div class="row g-3 mt-3">
      <div class="col-12 col-md-4"><div class="card border-0 bg-light"><div class="card-body py-2">
        <div class="text-muted small">Итого</div>
        <div class="fs-5 fw-semibold">@Model.Total</div>
      </div></div></div>
      <div class="col-6 col-md-4"><div class="card border-0 bg-light"><div class="card-body py-2">
        <div class="text-muted small">Оплачено</div>
        <div class="fs-5 fw-semibold">@Model.Paid</div>
      </div></div></div>
      <div class="col-6 col-md-4"><div class="card border-0 bg-light"><div class="card-body py-2">
        <div class="text-muted small">К оплате</div>
        <div class="fs-5 fw-semibold text-danger">@Model.Due</div>
      </div></div></div>
    </div>

  </div>
</div>
